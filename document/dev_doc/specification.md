# 質問管理Webシステム 仕様書

## 1. はじめに

### 1.1. システム概要

本システムは、プロジェクト内での質問とその回答を効率的に管理するためのWebアプリケーションです。ユーザー認証機能を備え、プロジェクトへのユーザー招待、質問の作成・回答・クローズ、回答フォームの利用、通知機能などを提供します。

### 1.2. 目的

*   プロジェクトにおける質問と回答のプロセスを可視化し、効率化する。
*   質問と回答の履歴を一元管理し、ナレッジの蓄積と共有を促進する。
*   回答期限の管理と通知により、回答漏れや遅延を防ぐ。

### 1.3. 対象読者

*   開発者
*   プロジェクトマネージャー
*   システム利用者

## 2. システム要件

### 2.1. 機能要件

#### 2.1.1. ユーザー認証

*   **認証方式:** メールアドレスとパスワードによる認証方式を採用します。
*   **ユーザー登録:** 新規ユーザーはメールアドレスとパスワードを設定して登録できます。
*   **ログイン/ログアウト:** 登録済みユーザーはメールアドレスとパスワードでログインし、ログアウトできます。
*   **パスワードリセット:** パスワードを忘れた場合、登録メールアドレス宛にリセットリンクを送信し、パスワードを再設定できる機能を提供します。
*   **ユーザーロール:**
    *   **Admin:** システム全体の管理者。
        *   全てのプロジェクトと質問を閲覧、編集、削除可能。
        *   ユーザー管理（招待、削除など）が可能。
    *   **プロジェクト管理者:** 特定のプロジェクトの管理者。
        *   担当プロジェクトの設定（プロジェクト名変更、タグ設定、ユーザー招待・除外）が可能。
        *   担当プロジェクト内の質問を閲覧、編集、削除可能。
        *   担当プロジェクトの参加者をプロジェクト管理者に任命可能。
        *   プロジェクト作成者は自動的にそのプロジェクトのプロジェクト管理者となります。
        *   プロジェクト管理者は複数人設定可能です。
    *   **通常ユーザー:** システムの一般利用者。
        *   自身が作成したプロジェクトと質問を閲覧、編集、削除可能。
        *   参加しているプロジェクト内の質問を閲覧し、回答可能。
        *   自身の回答のみ編集、削除可能。

#### 2.1.2. プロジェクト管理

*   **プロジェクト作成:** ユーザーは新しいプロジェクトを作成できます。作成者は自動的にそのプロジェクトのプロジェクト管理者になります。
*   **プロジェクト一覧:** ユーザーは自身が参加している、または管理しているプロジェクトの一覧を閲覧できます。Adminは全てのプロジェクトを閲覧できます。
*   **プロジェクト設定:** プロジェクト管理者は、プロジェクト名、説明、タグの選択肢などを設定・変更できます。
*   **ユーザー招待:**
    *   プロジェクト管理者は、既存ユーザーをプロジェクトに招待できます（一覧から選択）。既存ユーザーを選択した場合、そのユーザーは即座にプロジェクトメンバーとして追加されます。
    *   プロジェクト管理者は、未登録のユーザーをメールアドレスで招待できます。招待メールが送信されます。
*   **招待承認:** メールアドレスのみで招待されたユーザーは、システム上で招待を承認または拒否できます。承認後にプロジェクトへ参加となります。
*   **ユーザー除外:** プロジェクト管理者は、プロジェクトから参加ユーザーを除外できます。
*   **プロジェクト管理者任命:** プロジェクト管理者は、プロジェクト参加者をそのプロジェクトのプロジェクト管理者に任命できます。

#### 2.1.3. 質問管理

*   **質問作成:** ユーザーはプロジェクト内で新しい質問を作成できます。
    *   質問タイトル、内容、担当回答者（1名のみ）、回答期限、優先度（最高、高、中、低）、タグ（プロジェクトごとに設定された選択肢から複数選択可）を設定できます。
    *   回答形式として、自由記述形式またはカスタム回答フォーム形式を選択できます。
*   **質問一覧:**
    *   ユーザーは自身が関与する（質問者または回答者）質問の一覧を閲覧できます。
    *   プロジェクト管理者は担当プロジェクト内の全ての質問を閲覧できます。
    *   Adminは全ての質問を閲覧できます。
    *   要回答者向けの「要回答質問一覧」画面を提供します。
*   **質問詳細:** 質問の詳細情報（タイトル、内容、質問者、回答者、ステータス、期限、優先度、タグ、回答履歴など）を閲覧できます。
*   **質問編集:** 質問者は、質問の内容、担当回答者、期限、優先度、タグなどを編集できます（ステータスが「クローズ」以外の場合）。
*   **質問削除:** 質問者は、質問を削除できます。Adminも削除可能です。
*   **質問ステータス管理:**
    *   **新規:** 質問が作成された初期状態。
    *   **回答中:** 回答者が回答を開始した、または回答が投稿された状態。
    *   **承認待ち:** 回答が投稿され、質問者の承認を待っている状態。
    *   **クローズ:** 質問者が回答を承認し、質問が完了した状態。
*   **質問クローズ:** 質問者は、投稿された回答を確認し、承認することで質問を「クローズ」状態に変更できます。
*   **追加質問:** 質問者は、クローズされた質問に対して、スレッド形式で追加の質問を行うことができます。この場合、ステータスは「回答中」に戻ります。
*   **会話からの質問作成:** スレッド内の特定の会話（回答）を選択し、それを基に新しい質問を作成できます。元の会話内容は新しい質問の内容に引用されます。

#### 2.1.4. 回答管理

*   **回答投稿:**
    *   担当回答者は、割り当てられた質問に対して回答を投稿できます。
    *   自由記述形式の場合、テキストエリアに回答を入力します。
    *   回答フォーム形式の場合、定義されたフォーム項目に従って入力します。
    *   回答には、テキストに加え、画像ファイルや動画ファイル（1GBまで）を添付できます。
*   **回答フォーム作成:**
    *   質問作成時または編集中に、カスタム回答フォームを作成できます。
    *   フォーム項目として、テキストフィールド（一行）、数値、ラジオボタン、ファイルアップロード、自由テキスト（複数行）の5種類を利用でき、各項目に必須設定が可能です。
*   **回答フォームテンプレート:**
    *   作成した回答フォームをテンプレートとして保存できます。
    *   質問作成時に、保存したテンプレートを選択して回答フォームを設定できます。
*   **回答履歴（スレッド）:** 質問に対する回答は、スレッド形式で時系列に表示されます。
*   **回答編集:** 回答者は、自身が投稿した回答を編集できます（質問が「クローズ」されていない場合）。
*   **回答削除:** 回答者は、自身が投稿した回答を削除できます（質問が「クローズ」されていない場合）。

#### 2.1.5. 通知機能

*   **通知トリガー:** 以下のタイミングで通知が生成されます。
    *   自身が回答者で、回答期限が超過した場合。
    *   自身が質問者で、回答期限が超過した場合。
    *   自身が回答者として新しい質問が割り当てられた場合。
    *   自身の質問に対して回答が投稿された場合。
    *   自身が回答した質問がクローズされた場合。
*   **通知表示:**
    *   画面右上のベルマークアイコンに未読通知件数が表示されます。
    *   ベルマークをクリックすると、最新5件の通知がプルダウンで表示されます。
    *   プルダウン下部に「通知一覧へ」ボタンがあり、クリックすると通知一覧画面へ遷移します。
*   **通知一覧画面:**
    *   全ての通知が時系列で表示されます。
    *   未開封の通知のみで絞り込む機能を提供します。
*   **既読管理:** 通知は開封済みかどうかを管理します。プルダウンまたは一覧画面で通知をクリックすると既読になります。
*   **通知媒体:** Webシステム内の通知のみとし、メール通知は行いません。

#### 2.1.6. 検索機能

*   **質問検索:** 以下の条件で質問を検索できる機能を提供します。
    *   キーワード（質問タイトル、内容、回答内容に含まれる文字列）
    *   担当者（回答者）
    *   ステータス（新規、回答中、承認待ち、クローズ）
    *   期限切れ（回答期限を過ぎている質問）

### 2.2. 非機能要件

#### 2.2.1. 技術スタック

*   **フロントエンド:** Next.js (v14以上), Material UI v5 (DataGrid, Chart含む)
*   **バックエンド/ORM:** Prisma (最新安定版)
*   **データベース:** Neon (サーバーレスPostgreSQL)
*   **状態管理:** Zustand
*   **APIキャッシュ:** React Query（TanStack Query）
*   **ストレージ:** Vercel Blob (添付ファイル用)
*   **デプロイメント:** Vercel
*   **テスト:** Jest/Vitest + React Testing Library (単体/結合), Playwright/Cypress (E2E)
*   **エラー監視:** Vercel標準機能 (+ Sentry 導入検討)

#### 2.2.2. パフォーマンス

*   一般的なWebアプリケーションとして許容される応答速度を維持します。
*   特に質問一覧や検索結果の表示において、ストレスのない速度を目指します。
*   データベースクエリやAPIの最適化を行います。

#### 2.2.3. セキュリティ

*   パスワードはハッシュ化して保存します。
*   APIエンドポイントへのアクセス制御を適切に行います。
*   XSS、CSRFなどの一般的なWeb脆弱性対策を講じます。
*   依存ライブラリの脆弱性情報を定期的に確認し、必要に応じてアップデートします。

#### 2.2.4. 可用性

*   VercelおよびNeonのSLAに基づいた可用性を目指します。
*   サーバーレスアーキテクチャにより、スケーラビリティを確保します。

#### 2.2.5. 保守性

*   コードはリーダブルで、コンポーネント化、モジュール化を意識して実装します。
*   Prismaによる型安全なデータベースアクセスを行います。
*   適切なコメントやドキュメントを記述します。

#### 2.2.6. UI/UX

*   Material UI v5をベースとし、モダンで直感的なユーザーインターフェースを提供します。
*   レスポンシブデザインを採用し、デスクトップおよびモバイルデバイスでの利用に対応します。
*   ユーザーが迷わず操作できるよう、一貫性のあるデザインとナビゲーションを提供します。

#### 2.2.7. テスト

*   単体テスト、結合テスト、E2Eテストを実装し、品質を担保します。
*   テストフレームワークとしてJest/Vitest、React Testing Library、Playwright/Cypressを利用します。
*   テストカバレッジは、一般的なWebアプリケーションの水準（例: 70-80%程度）を目指しますが、具体的な目標値は開発状況に応じて調整します。

#### 2.2.8. エラー監視

*   Vercelの標準機能による基本的なエラー監視を行います。
*   必要に応じてSentryの導入を検討し、より詳細なエラー分析（フロントエンド/バックエンド）を行えるようにします。導入判断と監視対象はPoC後に決定します。

#### 2.2.9. デプロイメント

*   Vercelを利用してデプロイメントを行います。
*   GitリポジトリへのプッシュをトリガーとしたCI/CDパイプラインを構築します。

## 3. 用語集

*   **プロジェクト:** 質問管理の単位となるグループ。
*   **質問:** プロジェクト内で提起される問い合わせや課題。
*   **回答:** 質問に対する返答や解決策。
*   **スレッド:** 質問とそれに対する一連の回答のやり取り。
*   **回答フォーム:** 質問に対する回答を構造化するための入力フォーム。
*   **担当回答者:** 質問への回答責任者として指名されたユーザー。
*   **質問者:** 質問を提起したユーザー。
*   **Admin:** システム全体の管理者権限を持つユーザー。
*   **プロジェクト管理者:** 特定のプロジェクトの管理権限を持つユーザー。
*   **通常ユーザー:** 一般的なシステム利用者。
*   **タグ:** 質問を分類するためのラベル。
*   **優先度:** 質問の重要度を示すレベル。
*   **ステータス:** 質問の現在の状態（新規、回答中、承認待ち、クローズ）。
*   **通知:** システム内で発生したイベント（期限超過、新規割り当てなど）を利用者に知らせるメッセージ。


